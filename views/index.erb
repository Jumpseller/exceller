<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Lahsen - Vendder</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script type="text/javascript" src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-buttons.js"></script>
  <script type="text/javascript" src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-alerts.js"></script>

  <!-- Le styles -->
  <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
  <style type="text/css">
          /* Override some defaults */
      html, body {
          background-color: #eee;
      }
      body {
          padding-top: 40px; /* 40px to make the container go all the way to the bottom of the topbar */
      }
      .container > footer p {
          text-align: center; /* center align it with the container */
      }
      .container {
          width: 820px; /* downsize our container to make the content feel a bit tighter and more cohesive. NOTE: this removes two full columns from the grid, meaning you only go to 14 columns and not 16. */
      }

          /* The white background content wrapper */
      .content {
          background-color: #fff;
          padding: 20px;
          margin: 0 -20px; /* negative indent the amount of the padding to maintain the grid system */
          -webkit-border-radius: 0 0 6px 6px;
          -moz-border-radius: 0 0 6px 6px;
          border-radius: 0 0 6px 6px;
          -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.15);
          -moz-box-shadow: 0 1px 2px rgba(0,0,0,.15);
          box-shadow: 0 1px 2px rgba(0,0,0,.15);
      }

          /* Page header tweaks */
      .page-header {
          background-color: #f5f5f5;
          padding: 20px 20px 10px;
          margin: -20px -20px 20px;
      }

          /* Styles you shouldn't keep as they are for displaying this base example only */
      .content .span10,
      .content .span4 {
          min-height: 500px;
      }
          /* Give a quick and non-cross-browser friendly divider */
      .content .span4 {
          margin-left: 0;
          padding-left: 19px;
          border-left: 1px solid #eee;
      }

      .topbar .btn {
          border: 0;
      }

  </style>

  <!-- Le fav and touch icons -->
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">

  <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
</head>

<body>

<div class="topbar">
  <div class="fill">
    <div class="container">
      <a class="brand" href="http://bicis.lahsen.cl/admin" target="_blank">bicis.lahsen.cl</a>

      <ul class="nav">

        <li><a href="#ordenes">Ordenes</a></li>
        <li><a href="#productos">Productos</a></li>
        <!--<li><a href="#contact">Contact</a></li> -->
      </ul>

      <% if session['logged'] == true%>
          <a style="float: right; padding-top: 10px; padding-left: 5px;" href="/sign-out">Sign-out</a>
      <% else %>
          <form action="/sign-in" method="POST" class="pull-right">
            <input class="input-small" type="text" name="username" placeholder="Username" />

            <input class="input-small" type="password" name="password" placeholder="Password" />
            <button class="btn" type="submit">Sign in</button>
          </form>
      <% end %>
    </div>
  </div>
</div>

<div class="container">

  <div class="content">
    <div class="page-header">
      <h1>Lahsen <small>Integraciones ERP-Vendder</small></h1>
    </div>
    <% if session['error'] && !session['error'].empty? %>
        <div class="alert-message warning fade in" data-alert="alert">
          <a class="close" href="#">Ã—</a>
          <p><%=session['error']%></p>
        </div>
    <% end %>
    <% if session['logged'] == true%>
        <div class="row">
          <div class="span10">
            <a name="ordenes"></a>
            <br/><br/>
            <h2 name="ordenes">Ordenes de Compra</h2>
            <a style="float:right;margin-right: 10px;" id="new-csv" class="btn medium primary danger" data-loading-text="creando nuevo csv..." href="<%= url(:new) %>">Crear Nuevo</a>
            <table>
              <thead>
              <tr>
                <th>#</th>
                <th>Archivo</th>
              </tr>
              </thead>
              <tbody>
              <% i = 0 %>
              <% @csv_files.each do |file| %>
                  <tr>
                    <td><%=@csv_files.size - i%></td>
                    <td><a href="<%= url(:serve) + "/" + file %>" ><%=file%></a></td>
                  </tr>
                  <% i += 1 %>
              <% end %>
              </tbody>
            </table>
            <a name="productos"></a>
            <br/><br/>
            <h2>Productos</h2>
            <form style="text-align:right;" action="<%= url(:products_edit) %>" method="post" enctype="multipart/form-data">
              <input style="height: 23px;margin-right: 50px;" type="file" name="file">
              <input id="edit-products" class="btn medium primary danger" name="commit" type="submit" data-loading-text="actualizando..." value="Subir & Editar" />
            </form>
            <table>
              <thead>
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>SKU</th>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Stock</th>
              </tr>
              </thead>
              <tbody>
              <% j = 1 %>
              <% $products.each do |product| %>
                  <% if product["product"]["options"].empty? %>
                      <tr>
                        <td><%= j %></td>
                        <td><a href="<%= "https://lahsenbicis.vendder.com/admin/es/products/edit/#{product["product"]["id"]}" %>"><%= product["product"]["id"] %></a></td>
                        <td><%= product["product"]["sku"] %></td>
                        <td><%= product["product"]["name"] %></td>
                        <td><%= product["product"]["price"] %></td>
                        <td><%= product["product"]["stock"] %></td>
                      </tr>
                      <% j += 1 %>
                  <% else %>
                      <% product["product"]["options"].each do |option| %>
                          <% option["option"]["values"].each do |value| %>
                              <% value["value"]["properties"].each do |property| %>
                                  <tr>
                                    <td><%= j %></td>
                                    <td><a href="<%= "https://lahsenbicis.vendder.com/admin/es/products/edit/#{product["product"]["id"]}" %>"><%= product["product"]["id"] %></a></td>
                                    <td><%= property["property"]["sku"] %></td>
                                    <td><%= value["value"]["name"] %></td>
                                    <td><%= property["property"]["price"] %></td>
                                    <td><%= property["property"]["stock"] %></td>
                                  </tr>
                                  </tr>
                                  <% j += 1 %>
                              <% end %>
                          <% end %>
                      <% end %>
                  <% end %>
              <% end %>
              </tbody>
            </table>
          </div>
          <div class="span4">
            <h3>Ayuda</h3>
            <p style="">Los archivos son temporarios y eliminados cuando hay un restart en el servidor.</p>
          </div>
        </div>
    <% else %>
        <p>Please login.</p>
    <% end %>
  </div>

  <footer>
    <p>&copy; Lahsen 2011</p>

  </footer>

</div> <!-- /container -->

</body>
<script>
    $(function() {
        var csv_btn = $('#new-csv').click(function () {
            csv_btn.button('loading')
        })
        //var edit_btn = $('#edit-products').click(function () {
        //    edit_btn.button('loading')
        //})
    })
</script>
</html>



